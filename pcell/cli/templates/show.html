<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>pcell traces</title>
    <style>
      body {{ font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; }}
      .layout {{
        display: flex;
        gap: 1.5rem;
        align-items: flex-start;
      }}
      .plot-container {{
        flex: 3;
        min-width: 0;
      }}
      .controls {{
        flex: 1;
        max-width: 260px;
        font-size: 0.9rem;
      }}
      .unit-list {{
        max-height: 70vh;
        overflow-y: auto;
        border: 1px solid #ddd;
        padding: 0.5rem;
        border-radius: 4px;
      }}
      .unit-list label {{
        display: block;
        margin-bottom: 0.15rem;
      }}
      button {{
        margin-top: 0.75rem;
        padding: 0.4rem 0.8rem;
      }}
    </style>
  </head>
  <body>
    <h1>pcell traces</h1>
    <p>Showing {n} units from {minian_path}</p>
    <div class="layout">
      <div class="plot-container">
        {plot_div}
      </div>
      <div class="controls">
        <h2>Select units to keep</h2>
        <p style="margin-top:0;">
          Checkboxes are ordered top-to-bottom, matching the traces.
        </p>
        <div class="unit-list">
          {checkboxes_html}
        </div>
        <button id="download-btn">Download curated_units.txt</button>
      </div>
    </div>
    <script>
      document.getElementById('download-btn').addEventListener('click', function() {{
        const boxes = document.querySelectorAll('.unit-checkbox:checked');
        let lines = [];
        boxes.forEach(b => lines.push(b.value));
        const blob = new Blob([lines.join('\\n') + '\\n'], {{type: 'text/plain'}});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'curated_units.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }});
    </script>
  </body>
</html>

